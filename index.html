<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nm/kg 計算ミニアプリ</title>
  <style>
    :root { --bg:#f7f7fb; --card:#ffffff; --text:#111; --muted:#666; --line:#e6e6ef; --accent:#3b82f6; --accent-2:#2563eb; }
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans JP','Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    .header{padding:20px 24px;border-bottom:1px solid var(--line)}
    h1{margin:0;font-size:22px}
    .lead{margin:6px 0 0;color:var(--muted);font-size:14px}
    .controls{display:flex;flex-wrap:wrap;gap:12px;padding:16px 24px;align-items:end}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:12px;color:var(--muted)}
    input[type="number"], select{appearance:none;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:14px;min-width:120px}
    input[type="number"]:focus, select:focus{outline:2px solid var(--accent);border-color:var(--accent)}
    .btns{margin-left:auto;display:flex;gap:8px}
    button{padding:10px 14px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;font-size:14px}
    button.primary{background:var(--accent);border-color:var(--accent-2);color:#fff}
    button:hover{filter:brightness(0.98)}
    table{width:100%;border-collapse:separate;border-spacing:0 10px;padding:0 16px 16px}
    thead th{font-size:12px;color:var(--muted);font-weight:600;text-align:left;padding:0 8px}
    tbody tr{background:#fff;border:1px solid var(--line);border-radius:12px}
    tbody td{padding:10px 8px;vertical-align:middle}
    tbody tr td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .item{font-weight:600}
    .unit{color:var(--muted);font-size:12px;margin-left:4px}
    .result{font-variant-numeric:tabular-nums}
    .hint{padding:12px 24px;color:var(--muted);font-size:12px}
    .footer{padding:14px 24px;border-top:1px solid var(--line);color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <h1>Nm/kg 計算ミニアプリ</h1>
        <p class="lead">ニュートン(N) × モーメントアーム(m) ÷ 体重(kg) を自動計算します。</p>
      </div>

      <div class="controls">
        <div class="field">
          <label for="commonKg">共通体重 (kg) — 各行で未入力の場合に使用</label>
          <input id="commonKg" type="number" inputmode="decimal" step="0.1" min="0" placeholder="例: 60" />
        </div>
        <div class="field">
          <label for="decimals">小数点以下の桁数</label>
          <select id="decimals">
            <option value="1">1 桁</option>
            <option value="2" selected>2 桁</option>
            <option value="3">3 桁</option>
            <option value="4">4 桁</option>
          </select>
        </div>
        <div class="btns">
          <button id="clearBtn" type="button">クリア</button>
          <button id="csvBtn" type="button" class="primary">CSVダウンロード</button>
        </div>
      </div>

      <table aria-describedby="desc">
        <thead>
          <tr>
            <th>項目</th>
            <th>ニュートン <span class="unit">(N)</span></th>
            <th>モーメントアーム <span class="unit">(m)</span></th>
            <th>体重 <span class="unit">(kg)</span></th>
            <th>結果 <span class="unit">(Nm/kg)</span></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div id="desc" class="hint">使い方：N と m と体重を入力すると自動で <strong>Nm/kg</strong> を表示します。体重が未入力の場合は上の「共通体重」を使用します。</div>
      <div class="footer">計算式：<code>Nm/kg = (N × m) ÷ kg</code></div>
    </div>
  </div>

  <script>
    const ITEMS=['股関節屈曲','膝伸展','足背屈','股関節伸展','股関節外転','足底屈'];
    const tbody=document.getElementById('tbody');const decimalsEl=document.getElementById('decimals');const commonKgEl=document.getElementById('commonKg');
    function makeRow(name,i){const tr=document.createElement('tr');tr.innerHTML=`<td class="item">${name}</td>
      <td><input type="number" inputmode="decimal" step="0.1" min="0" placeholder="N" class="n" /></td>
      <td><input type="number" inputmode="decimal" step="0.001" min="0" placeholder="m" class="m" /></td>
      <td><input type="number" inputmode="decimal" step="0.1" min="0" placeholder="(未入力なら共通体重)" class="kg" /></td>
      <td class="result" data-row="${i}">—</td>`;return tr;}
    function num(el){const v=el.value.trim();if(v==='')return null;const n=Number(v);return Number.isFinite(n)&&n>=0?n:null;}
    function fmt(x){const d=Number(decimalsEl.value||2);return x.toFixed(d);}
    function calcRow(tr){const n=num(tr.querySelector('input.n')),m=num(tr.querySelector('input.m'));let kg=num(tr.querySelector('input.kg'));const out=tr.querySelector('.result');if(kg===null)kg=num(commonKgEl);if(n===null||m===null||kg===null||kg===0){out.textContent='—';out.title='';return null;}const val=(n*m)/kg;out.textContent=fmt(val);out.title=`${n}×${m}÷${kg}=${val}`;return val;}
    function calcAll(){[...tbody.querySelectorAll('tr')].forEach(calcRow);}
    function toCSV(){const rows=[['項目','N','m','kg(空欄=共通)','Nm/kg']];[...tbody.querySelectorAll('tr')].forEach(tr=>{
      const name=tr.querySelector('.item').textContent;const n=tr.querySelector('input.n').value;const m=tr.querySelector('input.m').value;const kgRaw=tr.querySelector('input.kg').value;const kg=kgRaw||commonKgEl.value||'';const res=tr.querySelector('.result').textContent;rows.push([name,n,m,kg,res]);});
      const csv=rows.map(r=>r.map(f=>`"${String(f).replaceAll('"','""')}"`).join(',')).join('\r\n');const blob=new Blob(["\uFEFF"+csv],{type:'text/csv;charset=utf-8;'});const a=document.createElement('a');const now=new Date();const y=now.getFullYear();const mth=String(now.getMonth()+1).padStart(2,'0');const d=String(now.getDate()).padStart(2,'0');a.href=URL.createObjectURL(blob);a.download=`nm_per_kg_${y}${mth}${d}.csv`;document.body.appendChild(a);a.click();a.remove();}
    function clearAll(){commonKgEl.value='';[...document.querySelectorAll('input.n, input.m, input.kg')].forEach(el=>el.value='');calcAll();}
    ITEMS.forEach((n,i)=>tbody.appendChild(makeRow(n,i)));
    document.addEventListener('input',e=>{const t=e.target;if(t.matches('input.n, input.m, input.kg'))calcRow(t.closest('tr'));if(t===commonKgEl||t.id==='decimals')calcAll();});
    document.getElementById('csvBtn').addEventListener('click',toCSV);document.getElementById('clearBtn').addEventListener('click',clearAll);
  </script>
</body>
</html>
